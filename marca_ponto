<?php
require_once __DIR__ . '/config.php';

$token = isset($_GET['token']) ? trim($_GET['token']) : '';
$obraId = isset($_GET['obra']) ? intval($_GET['obra']) : 0;

if (!$token || !$obraId || $token !== COMPANY_TOKEN) {
    http_response_code(403);
    echo "Acesso negado.";
    exit;
}

// busca dados da obra (opcional)
$obra = null;
try {
    $db = getDb();
    $stmt = $db->prepare('SELECT token, name FROM obras WHERE id = ? LIMIT 1');
    $stmt->execute([$obraId]);
    $obra = $stmt->fetch(PDO::FETCH_ASSOC);
} catch (Exception $e) {
    // ignore / fallback
}

$obraName = $obra ? htmlspecialchars($obra['name']) : 'Obra #' . $obraId;
?>
<!doctype html>
<html lang="pt-BR">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Marcar Ponto - <?= $obraName ?></title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
<div class="container">
  <h3>Marcar Ponto — <?= $obraName ?></h3>
  <p>Use os botões abaixo para marcar entrada ou saída.</p>
  <form method="post" action="mark_ponto.php" class="d-flex gap-2">
    <input type="hidden" name="obra" value="<?= $obraId ?>">
    <input type="hidden" name="token" value="<?= htmlspecialchars($token) ?>">
    <button name="type" value="entrada" class="btn btn-success">Marcar Entrada</button>
    <button name="type" value="saida" class="btn btn-danger">Marcar Saída</button>
  </form>
</div>
</body>
</html>